  <link rel="stylesheet" href="stylesheets/style.css">
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>


<div data-role="page" id="homepage">

	<div data-role="header">
		<h1>Page Title</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<p>Page content goes here.</p>


        <a href="#register" class="ui-btn">Register</a>
        <a href="#login" class="ui-btn">Login</a>



	</div><!-- /content -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page -->



<div data-role="page" id="register" >

	<div data-role="header">
		<h1>Register</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content" data-theme="b">

<div class="ui-grid-solo" class="ui-block-b" data-theme="b">


		<label for="username">Username:</label>
   	<input type="text" id="username"/> <br>



		<label for="email">Email:</label>
    <input type="text" id="email"/> <br>



		<label for="password">Password:</label>
    <input type="text" id="password"/> <br>



		<label for="address">Address:</label>
		<input type="text" id="address"/> <br>

<!--
			<label for="acctype"  >Account Type:</label>
			<input type="text" id="acctype" >
-->
  <label><input type="radio" name="atype" value="customer"  checked="checked">Customer</label>
  <label><input type="radio" name="atype" value="driver">Driver</label>
  <label><input type="radio" name="atype" value="manager">Manager</label>



				  <button id="submitbutton" class="ui-btn ui-btn-b ui-btn-inline"> Submit Button </button>


</div>





		<!--
    Account type <input type="text" id="acctype"/> <br">
-->



	</div><!-- /content -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page -->



<script>
// when the submitbutton is clicked
$( "#submitbutton" ).click(function(event) {
  // stop the default redirect of the browser
  event.preventDefault();

  // grab the values
  var username = $('#username').val();
  var email = $('#email').val();
  var password = $('#password').val();
  var address = $('#address').val();
//  var acctype = $('#acctype').val();


 var acctype = $('input[name="atype"]:checked').val();


  var isValid = true;

  if(username == ""){
     alert("Please enter a username");
     isValid = false;
  }
  if(!email.includes("@")){
     alert("Please enter a valid email");
     isValid = false;
  }

 // only send the data to the database, if the param is true.
  if(isValid == true){
      // send the data to the server-side
      $.post( "/putInDatabase", { username: username, email: email, password:password, address:address, acctype:acctype })
      .done(function( data ) {
        alert( "Data Loaded: " + data );
      });
  }



});

</script>








<div data-role="page" id="login">

	<div data-role="header">
		<h1>Login</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<p>Page content goes here.</p>


        Username <input type="text" id="loginUsername"/> <br>
        Password <input type="text" id="loginPassword"/> <br>


         <button id="loginbutton"> Login Button </button>



	</div><!-- /content -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page -->

<script>
// when the submitbutton is clicked
$( "#loginbutton" ).click(function(event) {
  // stop the default redirect of the browser
  event.preventDefault();

  // grabbing the values
  var un = $('#loginUsername').val();
  var pw = $('#loginPassword').val();

  if(un == "")
  {
     alert("Please enter a username");
  }
  if(pw ==""){
    alert("please enter a password");
  }


  $.post( "/checkTheLogin", { username: un, password: pw })
      .done(function( data ) {
        // say what the account type is

				if(data.includes("NONE")){

					alert( "Login failed, please enter valid username and password: "  );
				}


				else if(data.includes("customer")){

			            // move to the customer dashboard
			            window.location="/#customerdash";
			         }
			         else if(data.includes("driver")){


           // move to the driver dashboard
        }
        else if(data.includes("manager")){


           // make a call to the severside to get the data!
            $.get( "/getManagerData", function( data ) {
            // throw the data onto the manager page
                $( "#managerOutput" ).html( data );

            });


           // move to the manager dashboard
           window.location="/#manager";
        }


      });


 });

</script>

<script>
var myCart = [];

</script>

<div data-role="page" id="customerdash">

	<div data-role="header">
		<h1>Customer Dash</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<p>Page content goes here.</p>

        <div class="ui-field-contain">
            <label for="select-native-2">Chocolate Doughnut</label>

        <select id="chocolate_doughnut_qty" name="select-native-2" id="select-native-2" data-mini="true">
                <option value=""></option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        <button id="addtocart" onclick="addToCart('chocolate_doughnut_qty')"> Add To Cart </button>

        <button id="deleteProduct" onclick="deleteProduct('chocolate_doughnut_qty')">Delete product </button>

        </div>


        <div class="ui-field-contain">
            <label for="select-native-2">Ring Doughnut</label>

        <select id="ring_doughnut_qty" name="select-native-2" id="select-native-2" data-mini="true">
                <option value=""></option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        <button id="addtocart" onclick="addToCart('ring_doughnut_qty')"> Add To Cart </button>

        </div>




        <button id="goToCheckout"> Checkout </button>




	</div><!-- /content -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page -->



<div data-role="page" id="checkoutreview">

	<div data-role="header">
		<h1>Review your order</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">


          <div id="products">
          </div>

         <button id="insertintodb">Complete Checkout</button>

	</div><!-- /content -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page -->

<script>
$( "#insertintodb" ).click(function() {

    // get the persons username
     var orderby = $('#loginUsername').val();

     // get the list of products from the shopping cart
     var items = myCart.toString();

     $.post( "/completeCheckout", { orderby:orderby, items:items })
          .done(function( data ) {
            alert( "Data Loaded: " + data );
          });

});
</script>






<script>

$( "#goToCheckout" ).click(function() {

        // update the div tag with the shopping cart

        var cartItems = myCart.toString().split(',');
        // for each record, append them to the procuts div.

        // wipe the products div tag!
        $('#products').html('');

        for(var i=0; i< cartItems.length; i++){
            $('#products').append(cartItems[i] + '<br>');
        }



        // move to to the checkout review
        window.location="/#checkoutreview";
});


function deleteProduct(item){

    // loop over the cart
    myCart.forEach(function(itemCurrent, index, array) {

               // look for the item we want to delete.
               if(itemCurrent.includes(item)){
                  console.log("Removing previous reference to " + item);
                  myCart.pop(index);
               }
        });
}

function addToCart(itemName){
    // finding out the name of the ITEM we are adding
    var item = itemName;
	console.log(item);

    // dynamically find out the qty
	var qty = $('#'+item).children("option:selected").val();
	console.log(qty);

    // search the cart and see if we already added
    // the item. If we did, remove the old qty.

    myCart.forEach(function(itemCurrent, index, array) {



           if(itemCurrent.includes(item)){
              console.log("Removing previous reference to " + item);
              myCart.pop(index);
           }
    });


    // add the item to the cart
    myCart.push(item + '-' + qty);

    alert(myCart);

}

</script>

<div data-role="page" id="manager">

	<div data-role="header">
		<h1>Manager</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<p>Page content goes here.</p>

        <div id="managerOutput">

        </div>




	</div><!-- /content -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page -->
