 <link rel="stylesheet" href="stylesheets/style.css">
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<div data-role="page" id="homepage">

	<div data-role="header" data-theme="b">
    <a href="index.html" >DoNuts</a>

		<h1>HOME</h1>
    <a href="login.html">Logout</a>

    <div data-role="navbar">
		<ul>
			<li><a href="" class="ui-btn-active" data-icon="home">Home</a></li>
			<li><a href="#login" data-icon="user">Login</a></li>
			<li><a href="#register" data-icon="action">Register</a></li>
		</ul>
		</div>
	</div><!-- /header -->









	<div role="main" class="ui-content">
    <div class="ui-grid-solo" class="ui-block-b" data-theme="b">
      <h2 class="text-center">DoNuts the home of great doughnuts. You'll go crazy for the taste! </h2>



<H1 class="text-center">To ORDER <a href="#login" class="ui-btn-b ui-btn ui-btn-inline text-center">LOGIN </a>   or   <a href="#register" class="ui-btn-b ui-btn ui-btn-inline text-center" >REGISTER</a> </H1>


    </div>

    <div class="ui-grid-c">
         <div class="ui-block-a">
           <img src="/images/donut1.jpg" /></a><br>

         </div>
         <div class="ui-block-b">
           <img src="/images/donut4.jpg" /></a><br>

         </div>
         <div class="ui-block-c">
           <img src="/images/donut1.jpg" /></a><br>

         </div>
         <div class="ui-block-d">
           <img src="/images/donut4.jpg" /></a><br>

         </div>
       </div>






	</div><!-- /content -->

	<div data-role="footer"data-position="fixed" data-theme="b">
		<h4>DoNuts&copy; 2021</h4>
	</div><!-- /footer -->
</div><!-- /page -->






<div data-role="page" id="register" data-add-back-btn="true" >

	<div data-role="header" data-theme="b">
		<h1>Register</h1>

    <div data-role="navbar" data-theme="a">
    <ul>
      <li><a href="/"  data-icon="home">Home</a></li>
      <li><a href="#login" data-icon="user">Login</a></li>
      <li><a href="#register" data-icon="action" data-theme="a" class="ui-btn-active">Register</a></li>
    </ul>
    </div>
	</div><!-- /header -->

	<div role="main" class="ui-content" data-theme="b">

<div class="ui-grid-solo" class="ui-block-b" data-theme="b">
  <p>Please fill out the form below to create an account</p>
/*<a href="" data-rel="back">Go back..</a>*?

		<label for="username">Username:</label>
   	<input type="text" id="username"/> <br>



		<label for="email">Email:</label>
    <input type="text" id="email"/> <br>



		<label for="password">Password:</label>
    <input type="text" id="password"/> <br>



		<label for="address">Address:</label>
		<input type="text" id="address"/> <br>

<!--
			<label for="acctype"  >Account Type:</label>
			<input type="text" id="acctype" >
-->
  <label><input type="radio" name="atype" value="customer"  checked="checked">Customer</label>
  <label><input type="radio" name="atype" value="driver">Driver</label>
  <label><input type="radio" name="atype" value="manager">Manager</label>



<button id="submitbutton" class="ui-btn ui-btn-b ui-btn-inline"> Submit Button </button>


</div>




		<!--
    Account type <input type="text" id="acctype"/> <br">
-->



	</div><!-- /content -->

	<div data-role="footer" data-position="fixed" data-theme="b">
    <h4>DoNuts&copy; 2021</h4>
  </div><!-- /footer -->
</div><!-- /page -->









<script>
// when the submitbutton is clicked
$( "#submitbutton" ).click(function(event) {
  // stop the default redirect of the browser
  event.preventDefault();

  // grab the values
  var username = $('#username').val();
  var email = $('#email').val();
  var password = $('#password').val();
  var address = $('#address').val();
//  var acctype = $('#acctype').val();


 var acctype = $('input[name="atype"]:checked').val();


  var isValid = true;

  if(username == ""){
     alert("Please enter a username");
     isValid = false;
  }
  if(!email.includes("@")){
     alert("Please enter a valid email");
     isValid = false;
  }

 // only send the data to the database, if the param is true.
  if(isValid == true){
      // send the data to the server-side
      $.post( "/putInDatabase", { username: username, email: email, password:password, address:address, acctype:acctype })
      .done(function( data ) {
        alert( "Data Loaded: " + data );
		window.location="/#login"
      });
  }


});

</script>








<div data-role="page" id="login">

	<div data-role="header"  data-theme="b">
		<h1>Login</h1>
    <div data-role="navbar" data-theme="a">
    <ul>
      <li><a href="/"  data-icon="home">Home</a></li>
      <li><a href="#login" data-icon="user" class="ui-btn-active" data-theme="a">Login</a></li>
      <li><a href="#register" data-icon="action"  >Register</a></li>
    </ul>
    </div>
	</div><!-- /header -->

	<div role="main" class="ui-content">

<div class="ui-grid-solo" class="ui-block-b" data-theme="b">

  <div role="main" class="ui-content">
  		<p>Please login to place an order....</p>


          Username <input type="text" id="loginUsername"/> <br>
          Password <input type="text" id="loginPassword"/> <br>


           <button id="loginbutton" class="ui-btn ui-btn-b ui-btn-inline"> Login Button </button>



  	</div><!-- /content -->




</div>
	</div><!-- /content -->




<div data-role="footer" data-position="fixed" data-theme="b">
  <h4>DoNuts&copy; 2021</h4>
</div><!-- /footer -->
</div><!-- /page -->







<script>
// when the submitbutton is clicked
$( "#loginbutton" ).click(function(event) {
  // stop the default redirect of the browser
  event.preventDefault();

  // grabbing the values
  var un = $('#loginUsername').val();
  var pw = $('#loginPassword').val();

  if(un == "")
  {
     alert("Please enter a username");
  }
  if(pw ==""){
    alert("please enter a password");
  }


  $.post( "/checkTheLogin", { username: un, password: pw })
      .done(function( data ) {
        // say what the account type is

				if(data.includes("NONE")){

					alert( "Login failed, please enter valid username and password: "  );
				}


				else if(data.includes("customer")){

			            // move to the customer dashboard
			            window.location="/#customerdash";
			         }
			         else if(data.includes("driver")){

           // move to the driver dashboard
		      window.location="/#driverpage";
        }
        else if(data.includes("manager")){
            window.location="/#managerpage";

        }
      });

 });

</script>

<script>
var myCart = [];

</script>

<div data-role="page" id="customerdash">

	<div data-role="header">
		<h1>Customer Dash</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<p>Page content goes here.</p>

        <div class="ui-field-contain">
            <label for="select-native-2">Chocolate Doughnut</label>

        <select id="chocolate_doughnut_qty" name="select-native-2" id="select-native-2" data-mini="true">
                <option value=""></option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        <button id="addtocart" onclick="addToCart('chocolate_doughnut_qty')"> Add To Cart </button>

        <button id="deleteProduct" onclick="deleteProduct('chocolate_doughnut_qty')">Delete product </button>

        </div>


        <div class="ui-field-contain">
            <label for="select-native-2">Ring Doughnut</label>

        <select id="ring_doughnut_qty" name="select-native-2" id="select-native-2" data-mini="true">
                <option value=""></option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        <button id="addtocart" onclick="addToCart('ring_doughnut_qty')"> Add To Cart </button>

        </div>




        <button id="goToCheckout"> Checkout </button>




	</div><!-- /content -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page -->



<div data-role="page" id="checkoutreview">

	<div data-role="header">
		<h1>Review your order</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">


          <div id="products">
          </div>

         <button id="insertintodb">Complete Checkout</button>

	</div><!-- /content -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /footer -->
</div><!-- /page -->

<script>
$( "#insertintodb" ).click(function() {

    // get the persons username
     var orderby = $('#loginUsername').val();

     // get the list of products from the shopping cart
     var items = myCart.toString();

     $.post( "/completeCheckout", { orderby:orderby, items:items })
          .done(function( data ) {
            alert( "Data Loaded: " + data );
          });

});
</script>






<script>

$( "#goToCheckout" ).click(function() {

        // update the div tag with the shopping cart

        var cartItems = myCart.toString().split(',');
        // for each record, append them to the procuts div.

        // wipe the products div tag!
        $('#products').html('');

        for(var i=0; i< cartItems.length; i++){
            $('#products').append(cartItems[i] + '<br>');
        }



        // move to to the checkout review
        window.location="/#checkoutreview";
});


function deleteProduct(item){

    // loop over the cart
    myCart.forEach(function(itemCurrent, index, array) {

               // look for the item we want to delete.
               if(itemCurrent.includes(item)){
                  console.log("Removing previous reference to " + item);
                  myCart.pop(index);
               }
        });
}

function addToCart(itemName){
    // finding out the name of the ITEM we are adding
    var item = itemName;
	console.log(item);

    // dynamically find out the qty
	var qty = $('#'+item).children("option:selected").val();
	console.log(qty);

    // search the cart and see if we already added
    // the item. If we did, remove the old qty.

    myCart.forEach(function(itemCurrent, index, array) {



           if(itemCurrent.includes(item)){
              console.log("Removing previous reference to " + item);
              myCart.pop(index);
           }
    });


    // add the item to the cart
    myCart.push(item + '-' + qty);

    alert(myCart);

}

</script>

<div data-role="page" id="managerpage">

	<div data-role="header" data-theme="b">
		<h1>Manager</h1>
	</div><!-- /header -->
  <div data-role="navbar">
  <ul>
    <li><a href="/" data-icon="home">Home</a></li>
    <li><a href="#login" data-icon="user">Login</a></li>
    <li><a href="#register" data-icon="action">Register</a></li>
  </ul>
  </div>
	<div role="main" class="ui-content">
    <div role="main" class="ui-content">
      <div class="ui-grid-solo" class="ui-block-b" data-theme="b">
		<p>Create Your Reports</p>
    <p>Please select the dates for your report</p>

    <script>
    $( function() {
        $( "#fromdatepicker" ).datepicker({ dateFormat: 'dd-mm-yy' });
        $( "#todatepicker" ).datepicker({ dateFormat: 'dd-mm-yy' });
      } );

      </script>

        <div id="managerInput">
          <label for="from">From</label>
          <input type="text" id="fromdatepicker" name="from">
          <label for="to">to</label>
          <input type="text" id="todatepicker" name="to">
        </div>

		<div class="img-container">

		<table id="TableOfOrders">
		<tr>
			<th>ID</th>
			<th>Name</th>
			<th>Status</th>
			<th>Order</th>
			<th>Date</th>
			<th>Total</th>
			<th>Cancel</th>
		</tr>
		</table>
		</div>


<button id="listcustorders" class="ui-btn ui-btn-b ui-btn-inline"> List Orders  </button>
</div>
</div>
<script>

$( "#listcustorders" ).click(function(event) {

  event.preventDefault();

	var dateisValid = true;

    var dateFromVar = $('#fromdatepicker').datepicker('getDate');
    var dateToVar = $('#todatepicker').datepicker('getDate');

    if (dateFromVar == null) {
        alert("Please enter a From Date ");
        dateisValid = false;
    }

    if (dateToVar == null) {
        alert("Please enter a To Date ");
        dateisValid = false;
   }

	if (dateisValid == true){

		$.post( "/getManagerDataByDate", { fromdate  : dateFromVar, todate  : dateToVar })
			.done(function( data ) {

			var table = document.getElementById("TableOfOrders");

			if (table.rows.length > 1){
				for (var k = table.rows.length - 1; k > 0; k--) {
					table.deleteRow([k]);
				}
			}

            var  myArray = data;
			for(var i = 0; i < myArray.length; i++) {
				var ThisRow = myArray[i];
				var ordID = ThisRow['id'];
				var ordCust = ThisRow['orderby'];
				var ordItems = ThisRow['items'];
				var ordStatus  = ThisRow['orderstatus'];
				var ordDate = ThisRow['Orderdate'];
				var ordTotal = ThisRow['TotalPrice'];
				var row = table.insertRow(i+1);
				var cell0 = row.insertCell(0);
				var cell1 = row.insertCell(1);
				var cell2 = row.insertCell(2);
				var cell3 = row.insertCell(3);
				var cell4 = row.insertCell(4);
				var cell5 = row.insertCell(5);
				var cell6 = row.insertCell(6);
				cell6.onclick = function(){
					 var rowId = this.parentNode.rowIndex;
					 var myId = (document.getElementById("TableOfOrders").rows[rowId].cells[0].innerHTML);
					 var mystatus = "CANCELLED";
					  $.post( "/updateorderstatus", { orderid  : myId, newstatus : mystatus })
							.done(function( data ) {
									alert(data);
							});
					};

				cell0.innerHTML = ordID;
				cell1.innerHTML = ordCust;
				cell2.innerHTML = ordStatus;
				cell3.innerHTML = ordItems;
				cell4.innerHTML = ordDate;
				cell5.innerHTML = ordTotal;
				cell6.innerHTML = "Cancel Order";
			}
		});
	}
 });


</script>

	</div><!-- /content -->

  <div data-role="footer"data-position="fixed" data-theme="b">
    <h4>DoNuts&copy; 2021</h4>
  </div><!-- /footer -->
  </div><!-- /page -->









  <div data-role="page" id="driverpage">

	<div data-role="header" data-theme="b">
		<h1>Driver</h1>
	</div><!-- /header -->
  <div data-role="navbar">
  <ul>
    <li><a href="/" data-icon="home">Home</a></li>
    <li><a href="#login" data-icon="user">Login</a></li>
    <li><a href="#register" data-icon="action">Register</a></li>
  </ul>
  </div>
	<div role="main" class="ui-content">
  <div class="ui-grid-a">
    <div class="ui-block-a">
      <img src="/images/weather.jpg" /></div>
      <div class="ui-block-b">
  <h2 >The current temperature in Dublin: <span class="currentTemp"></span><span class="celsius">&#8451; </span><h2>
  </div>
  <script>

      $.getJSON( "http://api.weatherstack.com/current?access_key=1fffac0fb58e07f7413e366c7616c36d&query=Dublin", function( json ) {
        console.log( "JSON Data: " +json.current.temperature );

        $('.currentTemp').html(json.current.temperature);

      });
    </script>

</div>

<div class="ui-grid-solo">
  <div class ="ui-block-a">
		<table id="Table">
      <thead>
			<th>ID</th>
			<th>Name</th>
			<th>Status</th>
			<th>Order</th>
			<th>Date</th>
			<th>Total</th>
			<th>Delivery Address</th>
		</thead>
    <tbody id="listdriverorders"></tbody>
		</table>
</div>



<div class="ui-grid-a">
  <div class="ui-block-a">
    <div id="deliver">

     <input type="text" id="idtodeliver" name="deliver" placeholder="Enter item ID to mark as delivered">
        </div>
  </div>
  <div class="ui-block-b">
      <button id="delivercustorder" class="ui-btn ui-btn-b ui-btn-inline " >MARK DELIVERED </button>
</div>

  

</div>













  <script>

$(document).ready(loadorders);
  
  function loadorders(){

    		$.post( "/getDriverData",{})
    			.done(function( data ) {

      let res = '';
      data.forEach(data1 => {
        res += `<tr><td>${data1.id}</td><td>${data1.orderby}</td><td>${data1.orderstatus}</td><td>${data1.items}</td><td>${data1.orderdate}</td><td>${data1.totalprice}</td><td>${data1.deliveryaddress}</td></tr>`
      })
      $('#listdriverorders').html(res)
    });

  }




$( "#delivercustorder" ).click(function(event) {
 event.preventDefault();

 var idIsValid = true;
   var deliverId  = $('#idtodeliver').val();

   if (deliverId   == "") {
       alert("Please enter a Order ID to Complete");
       idIsValid = false;
   }

 if (idIsValid ==  true){
     var mystatus = "COMPLETE";

     $.post( "/updateorderstatus", { orderid  : deliverId, newstatus : mystatus })
         .done(function( data ) {
             alert(data);
            loadorders();
     });
 };
});


  </script>



	</div><!-- /content -->

  <div data-role="footer"data-position="fixed" data-theme="b">
		<h4>DoNuts&copy; 2021</h4>
	</div><!-- /footer -->
</div><!-- /page -->
